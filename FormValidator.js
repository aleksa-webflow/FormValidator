class FormValidator{constructor(t,e={}){this.root=document.querySelector(t),this.options={minDigits:6,allowedChars:"- ",firstDigits:"",detectCountry:!0,disableSubmit:!0,...e},this.submitButton=this.root.querySelector("[fv-submit]"),this.phoneInput=this.root.querySelector("[fv-phone]"),this.emailInput=this.root.querySelector("[fv-email]")}mount(){this.root&&(this.options.detectCountry?this.setCountryByLocation():this.setFirstCountry(),this.setupCountryClickHandlers(),this.setupInputHandlers(),this.validateForm())}setFirstCountry(){let t=this.root.querySelector("[fv-country]");console.log(t),t&&setTimeout(()=>{t.click()},0)}setCountryByLocation(){fetch("https://ipwho.is/").then(t=>t.json()).then(t=>{if(t&&t.country_code){let e=this.root.querySelector(`[data-country="${t.country_code.toUpperCase()}"]`);e&&e.click()}}).catch(console.error)}setupCountryClickHandlers(){this.root.querySelectorAll("[fv-country]").forEach(t=>{t.addEventListener("click",()=>{let e=t.querySelector("[fv-flag]"),i=t.querySelector("[fv-dial-code]"),s=this.root.querySelector("[fv-main-flag]");if(e&&s&&(s.src=e.src),i&&this.phoneInput){let o=`+${i.textContent.trim()} `;this.phoneInput.value=o,this.phoneInput.setAttribute("fv-dial-code",o),this.validateForm()}})})}setupInputHandlers(){this.phoneInput&&this.phoneInput.addEventListener("input",()=>{let t=this.phoneInput.getAttribute("fv-dial-code")||"",e=this.phoneInput.value;if(!e.startsWith(t)){this.phoneInput.value=t;return}let i=e.slice(t.length),s=this.options.allowedChars.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),o=RegExp(`[^0-9${s}]`,"g");i=i.replace(o,"");let n=RegExp(`([${s}])\\1+`,"g");(i=i.replace(n,"$1")).length>0&&this.options.firstDigits&&!this.options.firstDigits.includes(i.charAt(0))&&(i=i.slice(1)),i.length>0&&!/^\d/.test(i.charAt(0))&&(i=i.replace(/^./,"")),this.phoneInput.value=t+i,this.validateForm()}),this.emailInput&&this.emailInput.addEventListener("input",()=>{let t=this.emailInput.value.trim();/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t)?this.emailInput.classList.remove("invalid-email"):this.emailInput.classList.add("invalid-email"),this.validateForm()})}validateForm(){let t=!0,e=!0;if(this.phoneInput){let i=this.phoneInput.getAttribute("fv-dial-code")||"",s=this.phoneInput.value.slice(i.length),o=(s.match(/\d/g)||[]).length;t=o>=this.options.minDigits}if(this.emailInput){let n=this.emailInput.value.trim();e=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(n)}this.submitButton&&this.options.disableSubmit?t&&e?this.submitButton.classList.remove("fv-disable"):this.submitButton.classList.add("fv-disable"):this.submitButton&&!this.options.disableSubmit&&this.submitButton.classList.remove("fv-disable")}}
